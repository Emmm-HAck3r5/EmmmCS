#include "kbd.h"

static u8 kbd_buf[KBD_BUF_SIZE];
static u32 kbd_w_ptr = 0;
static u32 kbd_r_ptr = 0;

static const u8 scan_to_ascii[] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x60, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x71, 0x31, 0x00, 0x00, 0x00, 0x7A, 0x73, 0x61, 0x77, 0x32, 0x00,
    0x00, 0x63, 0x78, 0x64, 0x65, 0x34, 0x33, 0x00, 0x00, 0x20, 0x76, 0x66, 0x74, 0x72, 0x35, 0x00,
    0x00, 0x6E, 0x62, 0x68, 0x67, 0x79, 0x36, 0x00, 0x00, 0x00, 0x6D, 0x6A, 0x75, 0x37, 0x38, 0x00,
    0x00, 0x2C, 0x6B, 0x69, 0x6F, 0x30, 0x39, 0x00, 0x00, 0x2E, 0x2F, 0x6C, 0x3A, 0x71, 0x2D, 0x00,
    0x00, 0x00, 0x27, 0x00, 0x5B, 0x3D, 0x00, 0x00, 0x00, 0x00, 0x0D, 0x5D, 0x00, 0x5C, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x31, 0x00, 0x34, 0x37, 0x00, 0x00, 0x00,
    0x30, 0x2E, 0x32, 0x35, 0x36, 0x38, 0x00, 0x00, 0x00, 0x2B, 0x33, 0x2C, 0x2A, 0x39, 0x00, 0x00
};

void kbd_update(u8* args){
    if (args[0] == 1){
        kbd_buf[kbd_w_ptr % KBD_BUF_SIZE] = scan_to_ascii[args[1] % 128];
        args[0] = 0;
        kbd_w_ptr++;
    }
    return;
}

u8 kbd_getc(){
    if (kbd_r_ptr == kbd_w_ptr){
        return 0;
    }else{
        u8 ret = kbd_buf[kbd_r_ptr % KBD_BUF_SIZE];
        kbd_r_ptr++;
        return ret;
    }
}